---
name: kubelet
description: |
  An agent that runs on each node in the cluster. It makes sure that
  containers are running in a pod.

  The kubelet takes a set of PodSpecs that are provided through various
  mechanisms and ensures that the containers described in those PodSpecs are
  running and healthy. The kubelet doesnâ€™t manage containers which were not
  created by Kubernetes.

  Because of naming limitations in Kubernetes (the 63-character label limit),
  kubelet nodes are registered as "$id.k8s", where _$id_ is the UUID of the
  deployment VM.  This leads to 40-character names (36 or the UUID and 4 for
  the ".k8s" suffix), which are acceptable to API server.

  This in turn means that we **must** use BOSH-DNS when deploying k8s.
  Don't forget to add that to your director's runtime-config before deploying.

packages:
  - k8s
  - cfssl

consumes:
  - name: api
    type: k8s-apiserver

templates:
  bin/pre-start:   bin/pre-start
  tls/ca/cert.pem: tls/ca/cert.pem
  tls/ca/key.pem:  tls/ca/key.pem

  bin/kubelet:     bin/kubelet
  etc/kubelet.yml: etc/kubelet.yml

  # required for k8s naming limits.
  # don't forget to add the runtime-config
  dns/aliases.json: dns/aliases.json

properties:
  debug:
    description: Enables verbose debugging, suitable for troubleshooting.
    default:     false

  apiserver:
    default: '127.0.0.1:6443'
    description: |
      How to find the Kubernetes API server for reporting in as a node in the cluster.
      By default, the API server is expected to be running on loopback, but you can set
      this property to an "ip:port" of an external endpoint (i.e., a load balancer).

      Note: for large, highly-available clusters, where the kubelets are not necessarily
      co-located with the API server nodes, you *must* set this property.

  kubelet.flags:
    description: |
      A list of additional flags to pass to the kubelet daemon.  These flags are
      appended to the command-line after the hard-coded default flags.  Use this option
      with caution; it has the possibility to horribly break your deployment.

      Each item in the list should have a single key (the flag, minus the trailing `--`)
      whose value will be used as the flag value.
    default: []

# vim:ft=yaml
